<?xml version="1.0" encoding="UTF-8"?>
<DataService xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="DataService.xsd">
	
	<!-- 新增Video -->
	<SQLTrans TransFlag="1" TransName="saveVideo" DataGroupId="writeUser">
		<Insert>
			<OutputSQL>insert into video (userId,title,path,times,createTime,img) values({userId},{title},{path},{times},{currentTime},{img})</OutputSQL>
		</Insert>
		<OnException>
			<Return Code="-1" Info="保存数据异常" Text="保存数据异常"/>
		</OnException>
		<Return Code="0" Info="保存成功" Text="保存成功"/>
	</SQLTrans>
	<!-- 修改视频观看的次数 -->
	<SQLTrans TransFlag="1" TransName="updateCount" DataGroupId="writeUser">
		<Update>
			<OutputSQL>update video set count=count+1 where id={id}</OutputSQL>
		</Update>
		<OnException>
			<Return Code="-1" Info="修改数据异常" Text="修改数据异常"/>
		</OnException>
		<Return Code="0" Info="修改成功" Text="修改成功"/>
	</SQLTrans>	
	
	<!-- 分页查询Video -->
	<SQLTrans TransFlag="0" TransName="queryPageByVideo" DataGroupId="readUser" >
		<SelectField OutputId="{totalCount}">
			<OutputSQL>select count(*) from video where 1=1 and state=1 </OutputSQL>
			<SQLIf Value1="{userId}" Type="Long" Operator="EXIST">
				<SQLThen><OutputSQL>  and userId ={userId} </OutputSQL></SQLThen>
			</SQLIf>
		</SelectField>
		<SelectRecordSet OutputId="{videos}">
			<OutputSQL>select * from video where 1=1 and state=1 </OutputSQL>
			<SQLIf Value1="{userId}" Type="Long" Operator="EXIST">
				<SQLThen><OutputSQL>  and userId ={userId} </OutputSQL></SQLThen>
			</SQLIf>		
			<OutputSQL> order by createTime desc limit {startIndex},{pageSize}</OutputSQL>
		</SelectRecordSet>
		<OnException>
			<Return Code="-1" Text="查询异常" Info="VideoService.xml.queryPage(i)"></Return>
		</OnException>
		<Return Code="0" Text="查询成功" Info="查询成功">
			<ReturnItem FieldId="{pageNumber}" ValueId="{pageNumber}"/>
			<ReturnItem FieldId="{pageSize}" ValueId="{pageSize}"/>
			<ReturnItem FieldId="{totalCount}" ValueId="{totalCount}"/>
			<ReturnItem FieldId="{list}" ValueId="{videos}"/>
		</Return>
	</SQLTrans>	
	
	<!-- 分页查询推荐视频列表 -->
	<SQLTrans TransFlag="0" TransName="queryRecommendVideo" DataGroupId="readUser" >
		<SelectField OutputId="{totalCount}">
			<OutputSQL>select count(*) from video where 1=1 </OutputSQL>
			<SQLIf Value1="{state}" Type="Integer" Operator="EXIST">
				<SQLThen><OutputSQL>  and state ={state} </OutputSQL></SQLThen>
			</SQLIf>	
		</SelectField>
		<SelectRecordSet OutputId="{videos}">
			<OutputSQL>select * from video where 1=1 </OutputSQL>
			<SQLIf Value1="{state}" Type="Integer" Operator="EXIST">
				<SQLThen><OutputSQL>  and state ={state} </OutputSQL></SQLThen>
			</SQLIf>	
			<OutputSQL> order by count desc limit {startIndex},{pageSize}</OutputSQL>
		</SelectRecordSet>
		<OnException>
			<Return Code="-1" Text="查询异常" Info="VideoService.xml.queryPage(i)"></Return>
		</OnException>
		<Return Code="0" Text="查询成功" Info="查询成功">
			<ReturnItem FieldId="{pageNumber}" ValueId="{pageNumber}"/>
			<ReturnItem FieldId="{pageSize}" ValueId="{pageSize}"/>
			<ReturnItem FieldId="{totalCount}" ValueId="{totalCount}"/>
			<ReturnItem FieldId="{list}" ValueId="{videos}"/>
		</Return>
	</SQLTrans>	
	
	<!-- 修改视频审核状态等-->
	<SQLTrans TransFlag="1" TransName="updateState" DataGroupId="writeUser">
		<Update>
			<OutputSQL>update video set state={state} where id={id}</OutputSQL>
		</Update>
		<OnException>
			<Return Code="-1" Info="修改数据异常" Text="修改状态异常"/>
		</OnException>
		<Return Code="0" Info="修改状态成功" Text="修改状态成功"/>
	</SQLTrans>	
	
</DataService>