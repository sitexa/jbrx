<?xml version="1.0" encoding="UTF-8"?>
<DataService xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="DataService.xsd">
	
	<!-- 新增UsersAddress -->
	<SQLTrans TransFlag="1" TransName="saveUsersAddress" DataGroupId="writeUser">
		<SelectField OutputId="{count}">
			<OutputSQL>select count(id) from usersAddress where userId={userId} and status=1 </OutputSQL>
		</SelectField>
		<If Value1="{count}" Type="Long" Operator="&gt;" Value2="9">
			<Then>
				<Return Code="1" Info="最多只能添加10个收货地址" Text="最多只能添加10个收货地址"/>
			</Then>
		</If>
		<Update>
			<OutputSQL>update usersAddress set isDefault=2 where userId={userId}</OutputSQL>
		</Update>
		<Insert>
			<OutputSQL>insert into usersAddress (userId,reciever,phone,province,city,county,address,isDefault,status,createTime) values({userId},{reciever},{phone},{province},{city},{county},{address},1,1,{currentTime})</OutputSQL>
		</Insert>
		<OnException>
			<Return Code="-1" Info="新增UsersAddress数据库异常" Text="新增UsersAddress数据库异常"/>
		</OnException>
		<Return Code="0" Info="新增UsersAddress成功" Text="新增UsersAddress成功"/>
	</SQLTrans>
	
	<SQLTrans TransFlag="1" TransName="updateUsersAddress" DataGroupId="writeUser">
		<Update>
			<OutputSQL>update usersAddress set reciever={reciever},phone={phone},province={province},city={city},county={county},address={address} where id={id} and userId={userId}</OutputSQL>
		</Update>
		<OnException>
			<Return Code="-1" Info="修改UsersAddress数据库异常" Text="修改UsersAddress数据库异常"/>
		</OnException>
		<Return Code="0" Info="修改UsersAddress成功" Text="修改UsersAddress成功"/>
	</SQLTrans>	
	
	<SQLTrans TransFlag="1" TransName="deleteUsersAddress" DataGroupId="writeUser">
		<Update>
			<OutputSQL>update usersAddress set status=2 where id={id} and userId={userId}</OutputSQL>
		</Update>
		<OnException>
			<Return Code="-1" Info="删除用户地址数据库异常" Text="删除用户地址数据库异常"/>
		</OnException>
		<Return Code="0" Info="删除用户地址成功" Text="删除用户地址成功"/>
	</SQLTrans>	
	
	<!-- 分页查询UsersAddress -->
	<SQLTrans TransFlag="0" TransName="queryUsersAddressPage" DataGroupId="readUser" >
		<SelectField OutputId="{totalCount}">
			<OutputSQL>select count(*) from usersAddress where userId={userId} and status=1 </OutputSQL>
		</SelectField>
		<SelectRecordSet OutputId="{usersAddresss}">
			<OutputSQL>select * from usersAddress where userId={userId} and status=1  limit {startIndex},{pageSize}</OutputSQL>
		</SelectRecordSet>
		<OnException>
			<Return Code="-1" Text="查询UsersAddress信息异常" Info="UsersAddressService.xml.queryPage(i)"></Return>
		</OnException>
		<Return Code="0" Text="查询UsersAddress信息成功" Info="查询UsersAddress信息成功">
			<ReturnItem FieldId="{pageNumber}" ValueId="{pageNumber}"/>
			<ReturnItem FieldId="{pageSize}" ValueId="{pageSize}"/>
			<ReturnItem FieldId="{totalCount}" ValueId="{totalCount}"/>
			<ReturnItem FieldId="{list}" ValueId="{usersAddresss}"/>
		</Return>
	</SQLTrans>	
	
	<SQLTrans TransFlag="0" TransName="queryUsersAddressById" DataGroupId="readUser" >
		<SelectRecord OutputId="{usersAddress}">
			<OutputSQL>select * from usersAddress where id={id} and userId={userId}</OutputSQL>
		</SelectRecord>
		<OnException>
			<Return Code="-1" Text="查询UsersAddress信息异常" Info="UsersAddressService.xml.queryById(i)"></Return>
		</OnException>
		<Return Code="0" Text="查询UsersAddress信息成功" Info="查询UsersAddress信息成功">
			<ReturnItem FieldId="{usersAddress}" ValueId="{usersAddress}"/>
		</Return>
	</SQLTrans>		
</DataService>