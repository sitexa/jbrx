<?xml version="1.0" encoding="UTF-8"?>
<DataService xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../DataService.xsd">
	
	<!-- 新增Upgrade -->
	<SQLTrans TransFlag="1" TransName="saveUpgrade" DataGroupId="writeSystem">
		<Insert>
			<OutputSQL>insert into upgrade (verName,verCode,verDesc,aosUrl,iosUrl,upType,status,createTime) values({verName},{verCode},{verDesc},{aosUrl},{iosUrl},{upType|1},{status|1},{currentTime})</OutputSQL>
		</Insert>
		<OnException>
			<Return Code="-1" Info="新增Upgrade数据库异常" Text="新增Upgrade数据库异常"/>
		</OnException>
		<Return Code="0" Info="新增Upgrade成功" Text="新增Upgrade成功"/>
	</SQLTrans>
	
	<SQLTrans TransFlag="1" TransName="updateUpgrade" DataGroupId="writeSystem">
		<Update>
			<OutputSQL>update upgrade set verName={verName},verCode={verCode},verDesc={verDesc},aosUrl={aosUrl},iosUrl={iosUrl},upType={upType},status={status} where id={id}</OutputSQL>
		</Update>
		<OnException>
			<Return Code="-1" Info="修改Upgrade数据库异常" Text="修改Upgrade数据库异常"/>
		</OnException>
		<Return Code="0" Info="修改Upgrade成功" Text="修改Upgrade成功"/>
	</SQLTrans>	
	
	<!-- 分页查询Upgrade -->
	<SQLTrans TransFlag="0" TransName="queryUpgradePage" DataGroupId="readSystem" >
		<SelectField OutputId="{totalCount}">
			<OutputSQL>select count(*) from upgrade where 1=1 </OutputSQL>
			<SQLIf Value1="{verName}" Type="String" Operator="EXIST">
				<SQLThen><OutputSQL>  and verName like '%{r:verName}%'</OutputSQL></SQLThen>
			</SQLIf>
		</SelectField>
		<SelectRecordSet OutputId="{upgrades}">
			<OutputSQL>select * from upgrade where 1=1 </OutputSQL>
			<SQLIf Value1="{verName}" Type="String" Operator="EXIST">
				<SQLThen><OutputSQL>  and verName like '%{r:verName}%'</OutputSQL></SQLThen>
			</SQLIf>
			<OutputSQL> limit {startIndex},{pageSize}</OutputSQL>
		</SelectRecordSet>
		<OnException>
			<Return Code="-1" Text="查询Upgrade信息异常" Info="UpgradeService.xml.queryPage(i)"></Return>
		</OnException>
		<Return Code="0" Text="查询Upgrade信息成功" Info="查询Upgrade信息成功">
			<ReturnItem FieldId="{pageNumber}" ValueId="{pageNumber}"/>
			<ReturnItem FieldId="{pageSize}" ValueId="{pageSize}"/>
			<ReturnItem FieldId="{totalCount}" ValueId="{totalCount}"/>
			<ReturnItem FieldId="{list}" ValueId="{upgrades}"/>
		</Return>
	</SQLTrans>	
	
	<SQLTrans TransFlag="0" TransName="queryUpgradeById" DataGroupId="readSystem" >
		<SelectRecord OutputId="{upgrade}">
			<OutputSQL>select * from upgrade where id={id} </OutputSQL>
		</SelectRecord>
		<OnException>
			<Return Code="-1" Text="查询Upgrade信息异常" Info="UpgradeService.xml.queryById(i)"></Return>
		</OnException>
		<Return Code="0" Text="查询Upgrade信息成功" Info="查询Upgrade信息成功">
			<ReturnItem FieldId="{upgrade}" ValueId="{upgrade}"/>
		</Return>
	</SQLTrans>	
	
	<SQLTrans TransFlag="0" TransName="queryUpgrade" DataGroupId="readSystem" >
		<SelectRecord OutputId="{upgrade}">
			<OutputSQL>select * from upgrade where STATUS=1 ORDER BY verCode desc LIMIT 1</OutputSQL>
		</SelectRecord>
		<OnException>
			<Return Code="-1" Text="查询最新版本信息异常" Info="UpgradeService.xml.queryById(i)"></Return>
		</OnException>
		<Return Code="0" Text="查询最新版本信息成功" Info="查询最新版本信息成功">
			<ReturnItem FieldId="{upgrade}" ValueId="{upgrade}"/>
		</Return>
	</SQLTrans>	
	
	<SQLTrans TransFlag="1" TransName="revoke" DataGroupId="writeSystem">
		<Update RecordCountId="{updateCount}">
			<OutputSQL>update upgrade set status=3 where id={id}</OutputSQL>
		</Update>
		<If Value1="{updateCount}" Type="Integer" Operator="=" Value2="0">
				<Then>
					<Return Code="1" Info="撤销失败" Text="撤销失败"/>
				</Then>
		</If>
		<OnException>
			<Return Code="-1" Info="撤销异常" Text="撤销异常"/>
		</OnException>
		<Return Code="0" Info="撤销成功" Text="撤销成功"/>
	</SQLTrans>	
	
	<SQLTrans TransFlag="1" TransName="release" DataGroupId="writeSystem">
		<Update RecordCountId="{updateCount}">
			<OutputSQL>update upgrade set status=1 where id={id}</OutputSQL>
		</Update>
		<If Value1="{updateCount}" Type="Integer" Operator="=" Value2="0">
				<Then>
					<Return Code="1" Info="发布失败" Text="发布失败"/>
				</Then>
		</If>
		<OnException>
			<Return Code="-1" Info="发布异常" Text="发布异常"/>
		</OnException>
		<Return Code="0" Info="发布成功" Text="发布成功"/>
	</SQLTrans>	
		
</DataService>