<?xml version="1.0" encoding="UTF-8"?>
<DataService xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="DataService.xsd">
	
	<!-- 新增Dept -->
	<SQLTrans TransFlag="1" TransName="saveDept" DataGroupId="writeSystem">
		<Insert>
			<OutputSQL>insert into dept (parentId,name,province,city,county,street,address,status,createTime) values({parentId|0},{name},{province},{city},{county},{street|''},{address|''},{status|1},{currentTime})</OutputSQL>
		</Insert>
		<OnException>
			<Return Code="-1" Info="新增Dept数据库异常" Text="新增Dept数据库异常"/>
		</OnException>
		<Return Code="0" Info="新增Dept成功" Text="新增Dept成功"/>
	</SQLTrans>
	
	<SQLTrans TransFlag="1" TransName="updateDept" DataGroupId="writeSystem">
		<Update>
			<OutputSQL>update dept set parentId={parentId},name={name},province={province},city={city},county={county},street={street|''},address={address|''},status={status|1} where id={id}</OutputSQL>
		</Update>
		<OnException>
			<Return Code="-1" Info="修改Dept数据库异常" Text="修改Dept数据库异常"/>
		</OnException>
		<Return Code="0" Info="修改Dept成功" Text="修改Dept成功"/>
	</SQLTrans>	
	
	<!-- 分页查询Dept -->
	<SQLTrans TransFlag="0" TransName="queryDeptPage" DataGroupId="readSystem" >
		<SelectField OutputId="{totalCount}">
			<OutputSQL>select count(*) from dept where 1=1 </OutputSQL>
			<SQLIf Value1="{deptName}" Type="String" Operator="EXIST">
				<SQLThen><OutputSQL>  and name like '%{r:deptName}%'</OutputSQL></SQLThen>
			</SQLIf>
		</SelectField>
		<SelectRecordSet OutputId="{depts}">
			<OutputSQL>select * from dept where 1=1 </OutputSQL>
			<SQLIf Value1="{deptName}" Type="String" Operator="EXIST">
				<SQLThen><OutputSQL>  and name like '%{r:deptName}%'</OutputSQL></SQLThen>
			</SQLIf>	
			<OutputSQL> limit {startIndex},{pageSize}</OutputSQL>
		</SelectRecordSet>
		<OnException>
			<Return Code="-1" Text="查询Dept信息异常" Info="DeptService.xml.queryPage(i)"></Return>
		</OnException>
		<Return Code="0" Text="查询Dept信息成功" Info="查询Dept信息成功">
			<ReturnItem FieldId="{pageNumber}" ValueId="{pageNumber}"/>
			<ReturnItem FieldId="{pageSize}" ValueId="{pageSize}"/>
			<ReturnItem FieldId="{totalCount}" ValueId="{totalCount}"/>
			<ReturnItem FieldId="{list}" ValueId="{depts}"/>
		</Return>
	</SQLTrans>	
	
	<SQLTrans TransFlag="0" TransName="queryDeptById" DataGroupId="readSystem" >
		<SelectRecord OutputId="{dept}">
			<OutputSQL>select * from dept where id={id} </OutputSQL>
		</SelectRecord>
		<OnException>
			<Return Code="-1" Text="查询Dept信息异常" Info="DeptService.xml.queryById(i)"></Return>
		</OnException>
		<Return Code="0" Text="查询Dept信息成功" Info="查询Dept信息成功">
			<ReturnItem FieldId="{dept}" ValueId="{dept}"/>
		</Return>
	</SQLTrans>	
	
	<SQLTrans TransFlag="0" TransName="queryAllDept" DataGroupId="readSystem" >
		<SelectRecordSet OutputId="{list}">
			<OutputSQL>select id,name from dept</OutputSQL>
		</SelectRecordSet>
		<OnException>
			<Return Code="-1" Text="查询Dept信息异常" Info="DeptService.xml.queryAllDept(i)"></Return>
		</OnException>
		<Return Code="0" Text="查询Dept信息成功" Info="查询Dept信息成功">
			<ReturnItem FieldId="{list}" ValueId="{list}"/>
		</Return>
	</SQLTrans>		
</DataService>